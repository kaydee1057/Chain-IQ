<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Back Office</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- API Integration -->
    <script src="/api-integration.js"></script>
    <script src="/admin-integration.js"></script>
    <script src="/crypto-admin.js"></script>
    
    <style>
        /* Base Variables and Styles */
        :root{
            --bg-dark:#0a0a0f;
            --bg-dark-gray:#121218;
            --bg-gray:#1e1e26;
            --border:#2a2a34;
            --text-primary:#f0f0f5;
            --text-secondary:#a0a0b0;
            --text-tertiary:#6a6a7a;
            --accent-green:#20e6a0;
            --accent-red:#ff5a5a;
            --accent-yellow:#ffd75a;
            --accent-blue:#5a8cff;
            --highlight:rgba(90,140,255,.1);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body{
            font-family:'Inter',sans-serif;
            background-color: var(--bg-dark);
            color:var(--text-primary);
            -webkit-font-smoothing:antialiased;
            line-height:1.5;
        }

        /* Main Layout */
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .admin-sidebar {
            width: 260px;
            background-color: var(--bg-dark-gray);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }
        
        .sidebar-header {
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-logo {
            width: 36px;
            height: 36px;
            background-color: var(--accent-yellow);
            color: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .sidebar-nav {
            flex-grow: 1;
            padding: 16px;
            overflow-y: auto;
        }
        .sidebar-nav::-webkit-scrollbar{ width: 4px; }
        .sidebar-nav::-webkit-scrollbar-track{ background: transparent; }
        .sidebar-nav::-webkit-scrollbar-thumb{ background: var(--border); border-radius: 4px; }

        .nav-list {
            list-style: none;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 4px;
            transition: background-color 0.2s, color 0.2s;
        }
        .nav-link:hover {
            background-color: var(--highlight);
            color: var(--text-primary);
        }
        .nav-link.active {
            background-color: var(--accent-yellow);
            color: var(--bg-dark);
            font-weight: 600;
        }
        .nav-link i {
            width: 20px;
            text-align: center;
        }
        
        /* Main Content Area */
        .admin-main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background-color: var(--bg-dark-gray);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
            flex-shrink: 0;
        }

        .main-title {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .main-content {
            padding: 32px;
            overflow-y: auto;
            flex-grow: 1;
        }
        .main-content::-webkit-scrollbar{ width: 6px; }
        .main-content::-webkit-scrollbar-track{ background: transparent; }
        .main-content::-webkit-scrollbar-thumb{ background: var(--border); border-radius: 6px; }


        .admin-page {
            display: none;
        }
        .admin-page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Re-styling Admin Sections as Cards */
        .admin-section {
            background-color: var(--bg-dark-gray);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }
        
        .admin-section-header {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        /* Form & Table Styles (Re-using from original) */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-gray);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--accent-yellow); }
        .form-select {
            -webkit-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23a0a0b0" viewBox="0 0 16 16"><path d="M8 11L3 6h10z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
        }
        .btn-submit-card {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent-yellow), #f0b90b);
            color: #000;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 16px;
        }
        .btn-submit-card:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(252, 213, 53, 0.4); }
        .btn-secondary { background: var(--bg-gray); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--accent-yellow); }
        .form-row { display: flex; gap: 16px; margin-bottom: 16px; }
        .form-row > .form-group { flex: 1; margin-bottom: 0; }
        .admin-table-container { border-radius: 8px; border: 1px solid var(--border); overflow: hidden; width: 100%; overflow-x: auto; }
        .admin-table { width: 100%; min-width: 600px; border-collapse: collapse; }
        .admin-table th, .admin-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); font-size: 13px; }
        .admin-table tr:last-child td { border-bottom: none; }
        .admin-table th { background-color: var(--bg-gray); color: var(--text-secondary); font-weight: 600; text-transform: uppercase; }
        .admin-table td .btn-small { padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: background-color 0.2s; margin-right: 8px; white-space: nowrap; border: none; }
        .admin-table td .btn-delete { background-color: var(--accent-red); color: #fff; }
        .admin-table td .btn-delete:hover { background-color: #e04a4a; }
        .admin-table td .btn-accept { background-color: var(--accent-green); color: #000; }
        .admin-table td .btn-accept:hover { background-color: #1aae86; }
        .admin-table td .btn-edit, .admin-table td .btn-edit-name, .btn-edit-email { background-color: var(--accent-blue); color: #fff; }
        .admin-table td .btn-edit:hover, .admin-table td .btn-edit-name:hover, .btn-edit-email:hover { background-color: #4a77e0; }
        .admin-table td .btn-password, .admin-table td .btn-pin { background-color: var(--accent-yellow); color: #000; }
        .admin-table td .btn-password:hover, .admin-table td .btn-pin:hover { background-color: #f0b90b; }
        .admin-table td .btn-otp { background-color: var(--accent-green); color: #000; }
        .admin-table td .btn-otp:hover { background-color: #1aae86; }
        .admin-table td .btn-freeze { background-color: var(--accent-blue); color: #fff; }
        .status-frozen{color:var(--accent-yellow)}

        .otp-input-group { display: flex; align-items: center; gap: 8px; }
        .otp-input { width: 100px; padding: 6px 10px; background: var(--bg-gray); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 13px; }
        .toggle-switch-container { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border); transition: .2s; border-radius: 26px; }
        .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: var(--text-primary); transition: .2s; border-radius: 50%; }
        input:checked + .toggle-slider { background-color: var(--accent-yellow); }
        input:checked + .toggle-slider:before { transform: translateX(24px); }

        /* Modal Styles */
        .modal {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7);
            z-index: 200; display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .modal.active { display: flex; opacity: 1; }
        .modal-content {
            background: linear-gradient(145deg, var(--bg-dark-gray), #1e1e26);
            border: 1px solid var(--border); border-radius: 16px;
            width: 90%; max-width: 500px; padding: 32px; position: relative;
            transform: translateY(-20px); transition: transform 0.3s ease;
            max-height: 90vh; overflow-y: auto;
        }
        .modal.active .modal-content { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-title { font-size: 1.5rem; font-weight: 700; }
        .modal-close-btn { background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer; transition: color 0.2s; }
        .modal-close-btn:hover { color: var(--accent-red); }


        /* Mobile Responsiveness */
        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .admin-sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 100;
                transform: translateX(-100%);
            }
            .admin-sidebar.open {
                transform: translateX(0);
            }
            .mobile-toggle {
                display: block;
            }
            .main-header {
                padding: 16px;
            }
            .main-content {
                padding: 16px;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .form-row > .form-group {
                margin-bottom: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar Navigation -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">A</div>
                <h1 class="sidebar-title">Admin Panel</h1>
            </div>
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li><a href="#" class="nav-link active" data-target="platform-design"><i class="fas fa-palette"></i> Platform Design</a></li>
                    <li><a href="#" class="nav-link" data-target="card-customization"><i class="fas fa-credit-card"></i> Card Customization</a></li>
                    <li><a href="#" class="nav-link" data-target="display-settings"><i class="fas fa-desktop"></i> Display Settings</a></li>
                    <li><a href="#" class="nav-link" data-target="user-management"><i class="fas fa-users-cog"></i> User Management</a></li>
                    <li><a href="#" class="nav-link" data-target="balance-management"><i class="fas fa-wallet"></i> Balance Management</a></li>
                    <li><a href="#" class="nav-link" data-target="card-management"><i class="fas fa-cogs"></i> Card Management</a></li>
                    <li><a href="#" class="nav-link" data-target="transaction-management"><i class="fas fa-history"></i> Transactions</a></li>
                    <li><a href="#" class="nav-link" data-target="crypto-management"><i class="fas fa-coins"></i> Crypto Addresses</a></li>
                    <li><a href="#" class="nav-link" data-target="notifications"><i class="fas fa-bell"></i> Notifications</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="main-header">
                <button class="mobile-toggle" id="mobile-toggle"><i class="fas fa-bars"></i></button>
                <h2 class="main-title" id="main-title">Platform Design</h2>
            </header>
            <div class="main-content">

                <!-- Page: Platform Design -->
                <div class="admin-page active" id="platform-design">
                    <div class="admin-section">
                        <h3 class="admin-section-header">Theme & Branding</h3>
                        <form id="platform-design-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="app-name" class="form-label">App Name</label>
                                    <input type="text" id="app-name" class="form-input" value="Chain-IQ"/>
                                </div>
                                <div class="form-group">
                                    <label for="logo-initials" class="form-label">Logo Initials</label>
                                    <input type="text" id="logo-initials" class="form-input" maxlength="3" value="CIQ"/>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="logo-color" class="form-label">Logo & Highlight</label>
                                    <input type="color" id="logo-color" class="form-input" value="#ffd75a"/>
                                </div>
                                <div class="form-group">
                                    <label for="bg-color" class="form-label">Background Color</label>
                                    <input type="color" id="bg-color" class="form-input" value="#0a0a0f"/>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="font-color" class="form-label">Font Color</label>
                                    <input type="color" id="font-color" class="form-input" value="#f0f0f5"/>
                                </div>
                                <div class="form-group">
                                    <label for="btn-color" class="form-label">Button Color</label>
                                    <input type="color" id="btn-color" class="form-input" value="#5a8cff"/>
                                </div>
                            </div>
                            <div class="form-row">
                               <div class="form-group">
                                    <label for="card-color" class="form-label">UI Card Color</label>
                                    <input type="color" id="card-color" class="form-input" value="#121218"/>
                                </div>
                                <div class="form-group"></div> <!-- Spacer -->
                            </div>
                            <div class="flex gap-4">
                                <button type="submit" class="btn-submit-card flex-1">Save Design</button>
                                <button type="button" id="reset-design-btn" class="btn-submit-card btn-secondary flex-1">Reset to Default</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Page: Card Customization -->
                <div class="admin-page" id="card-customization">
                     <div class="admin-section">
                        <h3 class="admin-section-header">Virtual Card Customization</h3>
                        <form id="card-customization-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="card-brand-name" class="form-label">Card Brand Name</label>
                                    <input type="text" id="card-brand-name" class="form-input" />
                                </div>
                            </div>
                            <div id="card-type-settings">
                                <!-- Dynamic content for card types would be inserted here via JS -->
                            </div>
                            <button type="submit" class="btn-submit-card">Save Card Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Page: Display Settings -->
                <div class="admin-page" id="display-settings">
                    <div class="admin-section">
                        <h3 class="admin-section-header">Frontend Display Settings</h3>
                        <div class="form-group">
                            <div class="toggle-switch-container">
                                <label for="enable-stacked-view-toggle" class="form-label mb-0">Enable Stacked Card View</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enable-stacked-view-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group" id="stacked-view-options">
                            <label for="stacked-card-count" class="form-label">Number of Cards in Stack</label>
                            <select id="stacked-card-count" class="form-select">
                                <option value="all">All</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <div id="stacked-card-selector-group" class="mt-4 hidden">
                                <label class="form-label">Select Cards for Stack</label>
                                <div id="stacked-card-checkboxes"></div>
                            </div>
                        </div>
                        <hr style="border-color: var(--border); margin: 2rem 0;">
                        <div class="form-group">
                            <div class="toggle-switch-container">
                                <label for="lock-card-requests-toggle" class="form-label mb-0">Lock New Card Requests</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="lock-card-requests-toggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group hidden" id="lock-reason-group">
                            <label for="lock-reason-select" class="form-label">Reason for Locking</label>
                            <select id="lock-reason-select" class="form-select">
                                <option value="kyc">Complete KYC first</option>
                                <option value="submitted">Card Request already submitted</option>
                                <option value="blocked">Blocked or restricted from applying</option>
                                <option value="review">Account under review</option>
                                <option value="custom">Custom message</option>
                            </select>
                        </div>
                        <div class="form-group hidden" id="custom-lock-message-group">
                            <label for="custom-lock-message" class="form-label">Custom Lock Message</label>
                            <textarea id="custom-lock-message" class="form-textarea" rows="3" placeholder="Enter custom message for users..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Page: User Management -->
                <div class="admin-page" id="user-management">
                    <div class="admin-section">
                        <h3 class="admin-section-header">Create New User</h3>
                        <form id="create-user-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="new-user-name" class="form-label">Full Name</label>
                                    <input type="text" id="new-user-name" class="form-input" placeholder="e.g., Jane Smith" required />
                                </div>
                                <div class="form-group">
                                    <label for="new-user-email" class="form-label">Email</label>
                                    <input type="email" id="new-user-email" class="form-input" placeholder="e.g., jane@example.com" required />
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="new-user-password" class="form-label">Password</label>
                                    <input type="password" id="new-user-password" class="form-input" placeholder="••••••••" required />
                                </div>
                                <div class="form-group">
                                    <label for="new-user-role" class="form-label">Role</label>
                                    <select id="new-user-role" class="form-select">
                                        <option value="user">User</option>
                                        <option value="admin">Admin</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-submit-card">Create User</button>
                        </form>
                    </div>
                    <div class="admin-section">
                        <h3 class="admin-section-header">Manage Admins</h3>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr><th>Name</th><th>Email</th><th>Password</th><th>OTP</th><th>Actions</th></tr>
                                </thead>
                                <tbody id="admin-list-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="admin-section">
                        <h3 class="admin-section-header">Manage Users</h3>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr><th>Name</th><th>Email</th><th>Password</th><th>OTP</th><th>Actions</th></tr>
                                </thead>
                                <tbody id="user-list-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Page: Balance Management -->
                <div class="admin-page" id="balance-management">
                    <div class="admin-section">
                        <h3 class="admin-section-header">Manage Crypto Balances</h3>
                        <form id="crypto-balance-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="crypto-asset-select" class="form-label">Asset</label>
                                    <select id="crypto-asset-select" class="form-select"></select>
                                </div>
                                <div class="form-group">
                                    <label for="crypto-balance-amount" class="form-label">Amount</label>
                                    <input type="number" step="any" id="crypto-balance-amount" class="form-input" placeholder="e.g., 0.5" required />
                                </div>
                                <div class="form-group">
                                    <label for="crypto-balance-unit" class="form-label">Unit</label>
                                    <select id="crypto-balance-unit" class="form-select">
                                        <option value="crypto">Crypto</option>
                                        <option value="usd">USD</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-submit-card">Set Balance</button>
                        </form>
                    </div>
                    <div class="admin-section">
                        <h3 class="admin-section-header">Manage Card Balances</h3>
                        <form id="card-balance-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="card-select" class="form-label">Card</label>
                                    <select id="card-select" class="form-select"></select>
                                </div>
                                <div class="form-group">
                                    <label for="card-balance-amount" class="form-label">Balance (USD)</label>
                                    <input type="number" step="any" id="card-balance-amount" class="form-input" placeholder="e.g., 1000.00" required />
                                </div>
                            </div>
                            <button type="submit" class="btn-submit-card">Set Card Balance</button>
                        </form>
                    </div>
                    <div class="admin-section">
                        <h3 class="admin-section-header">Manage Wallet Addresses</h3>
                        <form id="wallet-address-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="wallet-asset-select" class="form-label">Asset</label>
                                    <select id="wallet-asset-select" class="form-select"></select>
                                </div>
                            </div>
                            <div id="wallet-address-inputs"></div>
                            <button type="submit" class="btn-submit-card">Save Addresses</button>
                        </form>
                    </div>
                </div>

                <!-- Page: Card Management -->
                <div class="admin-page" id="card-management">
                     <div class="admin-section">
                        <h3 class="admin-section-header">Direct Card Assignment</h3>
                        <form id="direct-assign-card-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="assign-direct-user" class="form-label">User</label>
                                    <select id="assign-direct-user" class="form-select" required></select>
                                </div>
                                <div class="form-group">
                                    <label for="assign-direct-name" class="form-label">Cardholder Name</label>
                                    <input type="text" id="assign-direct-name" class="form-input" placeholder="e.g., John Doe" required />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="assign-direct-number" class="form-label">Card Number</label>
                                <input type="text" id="assign-direct-number" class="form-input" placeholder="16-digit card number" required maxlength="16" />
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="assign-direct-expiry" class="form-label">Expiry Date (MM/YY)</label>
                                    <input type="text" id="assign-direct-expiry" class="form-input" placeholder="MM/YY" required />
                                </div>
                                <div class="form-group">
                                    <label for="assign-direct-cvv" class="form-label">CVV</label>
                                    <input type="text" id="assign-direct-cvv" class="form-input" placeholder="123" required maxlength="3" />
                                </div>
                                <div class="form-group">
                                    <label for="assign-direct-type" class="form-label">Card Type</label>
                                    <select id="assign-direct-type" class="form-select" required>
                                        <option value="platinum">Platinum</option>
                                        <option value="gold">Gold</option>
                                        <option value="premium">Premium</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-submit-card">Assign Card</button>
                        </form>
                    </div>
                    <div class="admin-section">
                        <h3 class="admin-section-header">Card Requests</h3>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr><th>User</th><th>Card Type</th><th>Status</th><th>Actions</th></tr>
                                </thead>
                                <tbody id="card-requests-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="admin-section">
                        <h3 class="admin-section-header">Manage All Cards</h3>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr><th>User</th><th>Card Number</th><th>PIN</th><th>Type</th><th>Status</th><th>Actions</th></tr>
                                </thead>
                                <tbody id="card-management-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Page: Transaction Management -->
                <div class="admin-page" id="transaction-management">
                    <div class="admin-section">
                        <h3 class="admin-section-header">Manually Add Transaction</h3>
                        <form id="add-transaction-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="tx-asset" class="form-label">Asset</label>
                                    <select id="tx-asset" class="form-select"></select>
                                </div>
                                <div class="form-group">
                                    <label for="tx-type" class="form-label">Type</label>
                                    <select id="tx-type" class="form-select">
                                        <option>Deposit</option>
                                        <option>Withdrawal</option>
                                        <option>Trade</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="tx-amount" class="form-label">Amount</label>
                                    <input type="text" id="tx-amount" class="form-input" placeholder="+0.5 BTC" required />
                                </div>
                                <div class="form-group">
                                    <label for="tx-fee" class="form-label">Fee</label>
                                    <input type="text" id="tx-fee" class="form-input" placeholder="0.0001 BTC" required />
                                </div>
                                <div class="form-group">
                                    <label for="tx-status" class="form-label">Status</label>
                                    <select id="tx-status" class="form-select">
                                        <option>Completed</option>
                                        <option>Pending</option>
                                        <option>Failed</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-submit-card">Add Transaction</button>
                        </form>
                    </div>
                     <div class="admin-section">
                        <h3 class="admin-section-header">Manage Withdrawals</h3>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr><th>ID</th><th>User</th><th>Asset</th><th>Amount</th><th>Status</th><th>Actions</th></tr>
                                </thead>
                                <tbody id="withdrawal-list-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Page: Notifications -->
                <div class="admin-page" id="notifications">
                    <div class="admin-section">
                        <h3 class="admin-section-header">Send Notification to User</h3>
                        <form id="send-notification-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="notification-user-select" class="form-label">User</label>
                                    <select id="notification-user-select" class="form-select"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notification-message-input" class="form-label">Message</label>
                                <textarea id="notification-message-input" class="form-input" rows="3" required></textarea>
                            </div>
                            <button type="submit" class="btn-submit-card">Send Notification</button>
                        </form>
                    </div>
                </div>
                
            </div>
        </main>
    </div>

    <!-- Utility Modals for Admin Actions -->
    <div class="modal" id="set-password-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Set Password for <span id="password-user-name"></span></h2>
                <button class="modal-close-btn" data-modal-id="set-password-modal"><i class="fas fa-times"></i></button>
            </div>
            <form id="set-password-form">
                <div class="form-group">
                    <label for="new-password" class="form-label">New Password</label>
                    <input type="password" id="new-password" class="form-input" placeholder="••••••••" required />
                </div>
                <button type="submit" class="btn-submit-card">Save New Password</button>
            </form>
        </div>
    </div>
    <div class="modal" id="edit-name-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Name for <span id="edit-name-user-name"></span></h2>
                <button class="modal-close-btn" data-modal-id="edit-name-modal"><i class="fas fa-times"></i></button>
            </div>
            <form id="edit-name-form">
                <div class="form-group">
                    <label for="edit-user-name" class="form-label">New Name</label>
                    <input type="text" id="edit-user-name" class="form-input" required />
                </div>
                <button type="submit" class="btn-submit-card">Save Name</button>
            </form>
        </div>
    </div>
    <div class="modal" id="edit-email-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Email for <span id="edit-email-user-email"></span></h2>
                <button class="modal-close-btn" data-modal-id="edit-email-modal"><i class="fas fa-times"></i></button>
            </div>
            <form id="edit-email-form">
                <div class="form-group">
                    <label for="edit-user-email" class="form-label">New Email</label>
                    <input type="email" id="edit-user-email" class="form-input" required />
                </div>
                <button type="submit" class="btn-submit-card">Save Email</button>
            </form>
        </div>
    </div>
    <div class="modal" id="notification-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="notification-title"></h2>
                <button class="modal-close-btn" data-modal-id="notification-modal"><i class="fas fa-times"></i></button>
            </div>
            <p id="notification-message" class="text-sm text-center text-secondary"></p>
        </div>
    </div>
    <div class="modal" id="assign-card-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="assign-card-modal-title">Assign Card</h2>
                <button class="modal-close-btn" data-modal-id="assign-card-modal"><i class="fas fa-times"></i></button>
            </div>
            <form id="assign-card-form">
                <input type="hidden" id="assign-card-id">
                <input type="hidden" id="assign-card-request-id">
                <div class="form-group">
                    <label for="assign-card-user" class="form-label">User</label>
                    <select id="assign-card-user" class="form-select" required></select>
                </div>
                <div class="form-group">
                    <label for="assign-card-type" class="form-label">Card Type</label>
                    <select id="assign-card-type" class="form-select" required>
                        <option value="platinum">Platinum</option>
                        <option value="gold">Gold</option>
                        <option value="premium">Premium</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assign-card-number" class="form-label">Card Number</label>
                    <input type="text" id="assign-card-number" class="form-input" placeholder="Enter 16-digit card number" required maxlength="16" />
                </div>
                <button type="submit" class="btn-submit-card">Save Card</button>
            </form>
        </div>
    </div>
    <div class="modal" id="set-pin-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Set PIN for Card <span id="pin-card-number"></span></h2>
                <button class="modal-close-btn" data-modal-id="set-pin-modal"><i class="fas fa-times"></i></button>
            </div>
            <form id="set-pin-form">
                <input type="hidden" id="set-pin-card-id">
                <div class="form-group">
                    <label for="new-pin" class="form-label">New PIN (4 digits)</label>
                    <input type="password" id="new-pin" class="form-input" placeholder="••••" required maxlength="4" pattern="\d{4}" />
                </div>
                <button type="submit" class="btn-submit-card">Set PIN</button>
            </form>
        </div>
    </div>
    <div class="modal" id="set-card-limits-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Set Card Limits</h2>
                <button class="modal-close-btn" data-modal-id="set-card-limits-modal"><i class="fas fa-times"></i></button>
            </div>
            <form id="set-card-limits-form">
                <input type="hidden" id="set-limits-card-id">
                <div class="form-group">
                    <label for="limit-daily" class="form-label">Daily Limit</label>
                    <input type="number" id="limit-daily" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="limit-monthly" class="form-label">Monthly Limit</label>
                    <input type="number" id="limit-monthly" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="limit-contactless" class="form-label">Contactless Limit</label>
                    <input type="number" id="limit-contactless" class="form-input" required>
                </div>
                <button type="submit" class="btn-submit-card">Save Limits</button>
            </form>
        </div>
    </div>

    <script>
        /* ---------- DATA STORE (from original file) ---------- */
        let cryptoData = [
            { id: 'bitcoin', asset: 'Bitcoin', ticker: 'BTC', price: 65000, change: 1.5, balance: 0.03, addresses: ['1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa', '1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2'] },
            { id: 'ethereum', asset: 'Ethereum', ticker: 'ETH', price: 3500, change: -0.5, balance: 0.4, addresses: ['0xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe'] },
            { id: 'solana', asset: 'Solana', ticker: 'SOL', price: 150, change: 3.2, balance: 5, addresses: ['So11111111111111111111111111111111111111112'] },
        ];
        let transactionData = [
            { id:'#TXN891234',asset:'Bitcoin',icon:'path/to/btc.png',type:'Deposit',amount:'+0.5 BTC',fee:'0.0001 BTC',status:'Completed', date: new Date('2025-07-25T10:00:00Z') },
            { id:'#TXN891233',asset:'Ethereum',icon:'path/to/eth.png',type:'Trade',amount:'+0.2 ETH',fee:'0.002 ETH',status:'Completed', date: new Date('2025-07-24T15:30:00Z') },
        ];
        let users = [
            { id: 'user-1', name: 'John Doe', email: 'john.doe@example.com', password: 'password123', role: 'admin', otp: '123456' },
            { id: 'user-2', name: 'Jane Smith', email: 'jane.smith@example.com', password: 'password123', role: 'user', otp: '654321' },
        ];
        let cardData = [
            { id: 'card-1', userId: 'user-1', type: 'platinum', cardNumber: '5123456789012345', pin: '1234', isFrozen: false, status: 'active', limits: { daily: 5000, monthly: 20000, contactless: 200 } },
            { id: 'card-2', userId: 'user-2', type: 'gold', cardNumber: '4123456789012345', pin: '5678', isFrozen: true, status: 'active', limits: { daily: 2000, monthly: 10000, contactless: 100 } },
        ];
        let cardRequestsData = [ { id: 'req-1', userId: 'user-2', cardType: 'premium', status: 'pending' }, ];
        let withdrawalData = [ { id: '#WDR12345', userId: 'user-2', asset: 'Bitcoin', amount: 0.1, status: 'Pending' } ];
        let notificationsData = [];
        const defaultPlatformSettings = {
            appName: 'Chain-IQ', logoInitials: 'CIQ', logoColor: '#ffd75a', bgColor: '#0a0a0f',
            fontColor: '#f0f0f5', btnColor: '#5a8cff', cardColor: '#121218', cardBrandName: 'Chain-IQ',
            cardTypes: {
                platinum: { name: 'Platinum', color1: '#333333', color2: '#111111' },
                gold: { name: 'Gold', color1: '#FFBF00', color2: '#FFBF00' },
                premium: { name: 'Premium', color1: '#1A237E', color2: '#5C6BC0' },
            }
        };
        let platformSettings = JSON.parse(JSON.stringify(defaultPlatformSettings));
        let displaySettings = {
            enableStackedView: true, stackedCardCount: 'all', stackedCardIds: [],
            lockCardRequests: false, lockReason: 'kyc', customLockMessage: ''
        };
        let currentUserId = null;


        /* ---------- UTILITY & MODAL FUNCTIONS ---------- */
        function showNotification(title, message) {
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').textContent = message;
            document.getElementById('notification-modal').classList.add('active');
            setTimeout(() => {
                 document.getElementById('notification-modal').classList.remove('active');
            }, 3000);
        }

        function setupModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.classList.remove('active');
                });
            });
            document.querySelectorAll('[data-modal-id]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById(btn.dataset.modalId).classList.remove('active');
                });
            });
        }


        /* ---------- ADMIN PANEL LOGIC ---------- */
        function renderUserTables() {
            const adminTbody = document.getElementById('admin-list-tbody');
            const userTbody = document.getElementById('user-list-tbody');
            adminTbody.innerHTML = '';
            userTbody.innerHTML = '';
            users.forEach(user => {
                const rowHTML = `
                    <td>${user.name}</td><td>${user.email}</td><td>${user.password}</td>
                    <td><div class="otp-input-group"><input type="text" class="otp-input" value="${user.otp}" data-id="${user.id}"><button class="btn-small btn-otp" data-id="${user.id}">Set</button></div></td>
                    <td>
                        <button class="btn-small btn-edit-name" data-id="${user.id}"><i class="fas fa-pen"></i> Name</button>
                        <button class="btn-small btn-edit-email" data-id="${user.id}"><i class="fas fa-envelope"></i> Email</button>
                        <button class="btn-small btn-password" data-id="${user.id}"><i class="fas fa-key"></i> Pass</button>
                        <button class="btn-small btn-delete" data-id="${user.id}"><i class="fas fa-trash"></i></button>
                    </td>`;
                if (user.role === 'admin') adminTbody.innerHTML += `<tr>${rowHTML}</tr>`;
                else userTbody.innerHTML += `<tr>${rowHTML}</tr>`;
            });
        }
        
        function populateAdminSelects() {
            document.getElementById('crypto-asset-select').innerHTML = cryptoData.map(c => `<option value="${c.id}">${c.asset}</option>`).join('');
            document.getElementById('wallet-asset-select').innerHTML = cryptoData.map(c => `<option value="${c.id}">${c.asset}</option>`).join('');
            document.getElementById('notification-user-select').innerHTML = users.map(u => `<option value="${u.id}">${u.name}</option>`).join('');
            document.getElementById('assign-direct-user').innerHTML = users.map(u => `<option value="${u.id}">${u.name}</option>`).join('');
            document.getElementById('tx-asset').innerHTML = cryptoData.map(c => `<option value="${c.id}">${c.asset}</option>`).join('');
            document.getElementById('card-select').innerHTML = cardData.map(c => `<option value="${c.id}">${users.find(u=>u.id===c.userId)?.name} - **** ${c.cardNumber.slice(-4)}</option>`).join('');
        }
        
        function handleUserAction(e) {
            const target = e.target.closest('button, input');
            if (!target) return;
            const userId = target.dataset.id;
            const user = users.find(u => u.id === userId);
            if (!user) return;

            if (target.classList.contains('btn-edit-name')) {
                currentUserId = userId;
                document.getElementById('edit-name-user-name').textContent = user.name;
                document.getElementById('edit-user-name').value = user.name;
                document.getElementById('edit-name-modal').classList.add('active');
            } else if (target.classList.contains('btn-edit-email')) {
                currentUserId = userId;
                document.getElementById('edit-email-user-email').textContent = user.email;
                document.getElementById('edit-user-email').value = user.email;
                document.getElementById('edit-email-modal').classList.add('active');
            } else if (target.classList.contains('btn-password')) {
                currentUserId = userId;
                document.getElementById('password-user-name').textContent = user.name;
                document.getElementById('set-password-modal').classList.add('active');
            } else if (target.classList.contains('btn-otp')) {
                user.otp = target.previousElementSibling.value;
                showNotification('Success', `OTP for ${user.name} set.`);
            } else if (target.classList.contains('btn-delete')) {
                if (confirm(`Are you sure you want to delete ${user.name}?`)) {
                    users = users.filter(u => u.id !== userId);
                    showNotification('Success', `User ${user.name} deleted.`);
                    renderUserTables();
                }
            }
        }
        
        function renderCardRequestsTable() {
            const tbody = document.getElementById('card-requests-tbody');
            tbody.innerHTML = cardRequestsData.map(req => {
                const user = users.find(u => u.id === req.userId);
                return `<tr>
                    <td>${user ? user.name : 'Unknown'}</td><td>${req.cardType}</td><td>${req.status}</td>
                    <td>${req.status === 'pending' ? `<button class="btn-small btn-accept" data-id="${req.id}">Accept</button><button class="btn-small btn-delete" data-id="${req.id}">Decline</button>` : 'Handled'}</td>
                </tr>`;
            }).join('');
        }

        function renderCardManagementTable() {
            const tbody = document.getElementById('card-management-tbody');
            tbody.innerHTML = cardData.map(card => {
                const user = users.find(u => u.id === card.userId);
                return `<tr>
                    <td>${user ? user.name : 'Unassigned'}</td><td>**** **** **** ${card.cardNumber.slice(-4)}</td><td>${card.pin}</td>
                    <td>${card.type}</td><td class="status-${card.isFrozen ? 'frozen' : card.status.toLowerCase()}">${card.isFrozen ? 'Frozen' : card.status}</td>
                    <td>
                        <button class="btn-small btn-edit" data-id="${card.id}">Edit</button>
                        <button class="btn-small btn-pin" data-id="${card.id}">Set PIN</button>
                        <button class="btn-small btn-freeze" data-id="${card.id}">${card.isFrozen ? 'Unfreeze' : 'Freeze'}</button>
                        <button class="btn-small btn-delete" data-id="${card.id}">Limits</button>
                    </td></tr>`;
            }).join('');
        }

        function renderWithdrawalTable() {
            const tbody = document.getElementById('withdrawal-list-tbody');
            tbody.innerHTML = withdrawalData.map(item => `
                <tr><td>${item.id}</td><td>${users.find(u=>u.id===item.userId)?.name}</td><td>${item.asset}</td><td>${item.amount}</td><td>${item.status}</td>
                <td><button class="btn-small btn-accept" data-id="${item.id}">Approve</button><button class="btn-small btn-delete" data-id="${item.id}">Block</button></td></tr>
            `).join('');
        }

        function applyPlatformDesign() {
            const { appName, logoInitials, logoColor, bgColor, fontColor, btnColor, cardColor } = platformSettings;
            document.querySelector('.sidebar-title').textContent = appName;
            document.querySelector('.sidebar-logo').textContent = logoInitials;
            const root = document.documentElement;
            root.style.setProperty('--bg-dark', bgColor);
            root.style.setProperty('--bg-dark-gray', bgColor);
            root.style.setProperty('--accent-yellow', logoColor);
            root.style.setProperty('--text-primary', fontColor);
            root.style.setProperty('--accent-blue', btnColor);
        }

        function setupAdminPanel() {
            // Populate selects
            populateAdminSelects();
            
            // Event Listeners for forms
            document.getElementById('create-user-form').addEventListener('submit', e => { e.preventDefault(); /* Logic from original */ renderUserTables(); });
            document.getElementById('admin-list-tbody').addEventListener('click', handleUserAction);
            document.getElementById('user-list-tbody').addEventListener('click', handleUserAction);
            document.getElementById('set-password-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('edit-name-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('edit-email-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('crypto-balance-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('card-balance-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('add-transaction-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('send-notification-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('card-requests-tbody').addEventListener('click', (e) => {/* ... */ renderCardRequestsTable(); });
            document.getElementById('card-management-tbody').addEventListener('click', (e) => {
                 const cardId = e.target.closest('button')?.dataset.id;
                 if(!cardId) return;
                 const card = cardData.find(c => c.id === cardId);
                 if (e.target.classList.contains('btn-freeze')) {
                    card.isFrozen = !card.isFrozen;
                    showNotification('Success', `Card ${card.isFrozen ? 'frozen' : 'unfrozen'}.`);
                    renderCardManagementTable();
                }
            });
            document.getElementById('assign-card-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('direct-assign-card-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('set-pin-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('set-card-limits-form').addEventListener('submit', e => { e.preventDefault(); /* ... */ });
            document.getElementById('platform-design-form').addEventListener('submit', e => {
                e.preventDefault();
                platformSettings.appName = document.getElementById('app-name').value;
                platformSettings.logoInitials = document.getElementById('logo-initials').value;
                platformSettings.logoColor = document.getElementById('logo-color').value;
                platformSettings.bgColor = document.getElementById('bg-color').value;
                platformSettings.fontColor = document.getElementById('font-color').value;
                platformSettings.btnColor = document.getElementById('btn-color').value;
                applyPlatformDesign();
                showNotification('Success', 'Platform design updated.');
            });
        }


        /* ---------- INITIALIZATION ---------- */
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const adminPages = document.querySelectorAll('.admin-page');
            const mainTitle = document.getElementById('main-title');
            const sidebar = document.getElementById('admin-sidebar');
            const mobileToggle = document.getElementById('mobile-toggle');

            // Navigation logic
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelector('.nav-link.active').classList.remove('active');
                    link.classList.add('active');
                    mainTitle.textContent = link.textContent.trim();
                    const targetId = link.getAttribute('data-target');
                    adminPages.forEach(page => {
                        page.classList.toggle('active', page.id === targetId);
                    });
                    if (window.innerWidth <= 768) sidebar.classList.remove('open');
                });
            });

            // Mobile sidebar toggle
            mobileToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 && sidebar.classList.contains('open') && !sidebar.contains(e.target) && !mobileToggle.contains(e.target)) {
                    sidebar.classList.remove('open');
                }
            });
            
            // Initial Setup
            setupModals();
            setupAdminPanel();
            applyPlatformDesign();
            renderUserTables();
            renderCardRequestsTable();
            renderCardManagementTable();
            renderWithdrawalTable();
        });
    </script>
</body>
</html>

